<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>单用户浏览路径（显示 Hide/Unload）</title>
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
<style>
  body { margin:0; font-family: Arial; padding:20px; }
  #chart { width: 100%; height: 300px; }
</style>
</head>
<body>
<h2>单用户浏览路径（显示 Hide/Unload）</h2>
<div id="chart"></div>

<script>
const events = [
  { path: '首页', eventType: 'AppLaunch', timestamp: 1000, duration: 0.5 },
  { path: '代码页', eventType: 'PageShow', timestamp: 2000 },
  { path: '代码页', eventType: 'PageHide', timestamp: 7000, duration: 5 },
  { path: '商户列表', eventType: 'PageShow', timestamp: 8000 },
  { path: '商户列表', eventType: 'PageUnload', timestamp: 9000, duration: 1 }
];

// 每个事件生成节点
const nodes = events.map(e => {
  return {
    path: e.path,
    eventType: e.eventType,
    duration: e.duration || 0,
    timestamp: e.timestamp,
    width: Math.max((e.duration || 1) * 50, 30) // 可视化停留时间
  }
});

// 累计横向坐标
let xPos = 0;
nodes.forEach(n => { n.x = xPos; xPos += n.width + 20; });

// 绘制
const chart = echarts.init(document.getElementById('chart'));
chart.setOption({
  tooltip: {
    formatter: params => `
      页面: ${params.data.path}<br/>
      类型: ${params.data.eventType}<br/>
      停留时间: ${params.data.duration.toFixed(2)}s<br/>
      时间: ${new Date(params.data.timestamp).toLocaleTimeString()}
    `
  },
  xAxis: { show:false, min:0, max:xPos },
  yAxis: { show:false },
  series: [
    {
      type:'custom',
      renderItem: (params, api) => {
        const e = nodes[params.dataIndex];
        let color = '#5470C6';
        if(e.eventType.includes('Hide') || e.eventType.includes('Unload')) color = '#EE6666';
        return {
          type:'rect',
          shape: { x:e.x, y:100, width:e.width, height:50 },
          style: { fill: color, stroke:'#333', lineWidth:1 },
          text: { text:e.eventType, fill:'#fff', x:e.x+e.width/2, y:125, align:'center', baseline:'middle' }
        }
      },
      encode: { x:'x', y:'y' },
      data: nodes
    },
    {
      type:'lines',
      coordinateSystem:'cartesian2d',
      polyline:true,
      lineStyle:{ color:'#999', width:2 },
      data: nodes.slice(0,-1).map((n,i)=>({
        coords: [
          [n.x+n.width, 125],
          [nodes[i+1].x, 125]
        ]
      }))
    }
  ]
});
</script>
</body>
</html>
